schema_type: dataframe
version: 1.0.0
name: operational_transactions
description: Schema for operational transaction files

columns:
  fecha_operacion:
    dtype: datetime64[ns]
    nullable: false
    checks:
      - name: date_not_in_future
        check_fn: less_than_or_equal_to
        params:
          value: "{{ now }}"
  
  numero_operacion:
    dtype: str
    nullable: false
    unique: true
    checks:
      - name: valid_format
        check_fn: str_matches
        params:
          pattern: "^OP-\\d{8}$"
  
  tipo_operacion:
    dtype: str
    nullable: false
    checks:
      - name: valid_type
        check_fn: isin
        params:
          allowed_values: ["DEPOSITO", "RETIRO", "TRANSFERENCIA"]
  
  monto:
    dtype: float64
    nullable: false
    checks:
      - name: positive_amount
        check_fn: greater_than
        params:
          value: 0
      - name: reasonable_limit
        check_fn: less_than_or_equal_to
        params:
          value: 1000000
  
  moneda:
    dtype: str
    nullable: false
    checks:
      - name: valid_currency
        check_fn: isin
        params:
          allowed_values: ["PEN", "USD"]
  
  cuenta_origen:
    dtype: str
    nullable: false
    checks:
      - name: valid_account_format
        check_fn: str_matches
        params:
          pattern: "^\\d{3}-\\d{7}-\\d-\\d{2}$"
  
  estado:
    dtype: str
    nullable: false
    checks:
      - name: valid_status
        check_fn: isin
        params:
          allowed_values: ["COMPLETADA", "PENDIENTE", "FALLIDA"]

coerce: true
strict: false